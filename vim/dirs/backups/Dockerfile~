# 基于基础镜像
FROM reg.docker.alibaba-inc.com/aone-base/tmall-testplatform_7u:20200406192443

# 指定运行时的系统环境变量,如下请替换appName为自己应用名称
ENV BUILD_APP_NAME tmall-testplatform

# 将应用nginx配置文件复制到镜像中
#COPY environment/testing/cai/bin/* /home/admin/cai/bin/
#COPY environment/testing/cai/bin/* /home/admin/crack/bin/
#RUN chmod +x /home/admin/crack/bin/setenv.sh
#COPY environment/testing/cai/conf/* /home/admin/cai/conf/

# 将构建出的主包复制到指定镜像目录中
#COPY tmall-testplatform.tgz /home/admin/$BUILD_APP_NAME/target/tmall-testplatform.tgz

#ai tester
RUN wget https://npm.taobao.org/mirrors/node/v10.9.0/node-v10.9.0-linux-x64.tar.gz  -P /tmp/ \
&& tar -zxvf /tmp/node-v10.9.0-linux-x64.tar.gz -C /tmp/ \
&& mv /tmp/node-v10.9.0-linux-x64/ /opt/taobao/install/nodejs \
&& export PATH=$PATH:/opt/taobao/install/nodejs/bin \
&& yum install git -y \
&& npm i npminstall -g --registry=https://registry.npm.alibaba-inc.com \
&& npminstall tnpm -g --registry=https://registry.npm.alibaba-inc.com \
&& chrome_deps='pango.x86_64 libXcomposite.x86_64 libXcursor.x86_64 libXdamage.x86_64 libXext.x86_64 libXi.x86_64 libXtst.x86_64 cups-libs.x86_64 libXScrnSaver.x86_64 libXrandr.x86_64 GConf2.x86_64 alsa-lib.x86_64 atk.x86_64 gtk3.x86_64 ipa-gothic-fonts xorg-x11-fonts-100dpi xorg-x11-fonts-75dpi xorg-x11-utils xorg-x11-fonts-cyrillic xorg-x11-fonts-Type1 xorg-x11-fonts-misc'  \
&& yum install $chrome_deps -y 

#&& git clone http://gitlab.alibaba-inc.com/iz/aiTesterServer.git /home/taofang.tf/ \
#&& cd /home/taofang.tf/aiTesterServer/ \
#&& tnpm i 
